<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <rewrite>
      <rules>

        <!-- Proxy backend API -->
        <rule name="ProxyBackendApi" stopProcessing="true">
          <match url="^front_conversor_excel_backend/api/(.*)" />
          <action type="Rewrite" url="http://localhost:3100/api/{R:1}" />
        </rule>

        <!-- Serve arquivos estáticos se existirem -->
        <rule name="StaticFiles" stopProcessing="true">
          <match url="^front_conversor_excel/(.*)$" />
          <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsFile" />
          </conditions>
          <action type="None" />
        </rule>

        <!-- Se pedirem exatamente /front_conversor_excel ou /front_conversor_excel/ -> index -->
        <rule name="FrontRootToIndex" stopProcessing="true">
          <match url="^front_conversor_excel/?$" />
          <action type="Rewrite" url="/front_conversor_excel/index.html" />
        </rule>

        <!-- SPA fallback: tudo em /front_conversor_excel* que não seja arquivo nem API vai para index.html -->
        <rule name="SPAFallback" stopProcessing="true">
          <match url="^front_conversor_excel(.*)" />
          <conditions logicalGrouping="MatchAll">
            <add input="{REQUEST_URI}" pattern="^/front_conversor_excel_backend" negate="true" />
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
            <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
          </conditions>
          <action type="Rewrite" url="/front_conversor_excel/index.html" />
        </rule>

      </rules>
    </rewrite>
  </system.webServer>
</configuration>